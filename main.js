(()=>{"use strict";var e,t=function(e,t,n,o,r,c,a,u,i,s,l,d,p){var f=r.querySelector(".places__item").cloneNode(!0),_=f.querySelector(".card__delete-button"),m=f.querySelector(".card__title"),v=f.querySelector(".card__image"),h=f.querySelector(".card__like-button"),y=f.querySelector(".card__like-counter");return e.likes.forEach((function(e){e._id===c&&h.classList.add("card__like-button_is-active")})),m.textContent=e.name,f.id=e._id,v.src=e.link,v.alt=e.name,y.textContent=e.likes.length,e.owner._id===c?_.addEventListener("click",(function(e){t(e,i,s,l,d,p)})):_.remove(),h.addEventListener("click",(function(e){n(e,a,u)})),v.addEventListener("click",(function(e){o(e)})),f},n=function(e,t,n){var o=e.target.closest(".card"),r=o.querySelector(".card__like-counter"),c=o.id;e.target.classList.contains("card__like-button_is-active")?n(c).then((function(e){r.textContent=e.likes.length})):t(c).then((function(e){r.textContent=e.likes.length})),e.target.classList.toggle("card__like-button_is-active")},o=function(e,t,n,o,r,c){var a=e.target.closest(".card");n(r),c.addEventListener("click",(function e(n){n.preventDefault(),t(a.id),a.remove(),o(r),c.removeEventListener("click",e)}))},r=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u),e.addEventListener("click",a)},c=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u),e.removeEventListener("click",a),i(e)},a=function(e){e.target.classList.contains("popup")&&c(e.target)},u=function(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))},i=function(e){var t=e.querySelectorAll(".popup__text-error"),n=e.querySelectorAll(".popup__input");t.forEach((function(e){e.textContent=""})),n.forEach((function(e){e.classList.remove("popup__input_error"),e.value=""}))},s=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0},l={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-17/",headers:{authorization:"f85af8b3-6b2a-4d1f-b9f0-5f2e64c5c8d2","Content-Type":"application/json"}},d=function(e){return fetch("".concat(l.baseUrl,"cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){return console.log(e)}))},p=function(e){return fetch("".concat(l.baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){return console.log(e)}))},f=function(e){return fetch("".concat(l.baseUrl,"cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){return console.log(e)}))},_=document.querySelector("#card-template").content,m=document.querySelector(".places__list"),v=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),y=document.querySelector(".profile__image"),E=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),S=k.querySelector(".popup__button"),b=document.querySelector(".popup_type_new-card"),g=document.querySelector(".profile__add-button"),q=b.querySelector(".popup__button"),L=document.forms["edit-profile"],C=L.elements.name,x=L.elements.description,j=document.forms["new-place"],P=j.elements["place-name"],U=j.elements.link,A=document.querySelector(".popup_type_image"),T=A.querySelector(".popup__image"),w=A.querySelector(".popup__caption"),D=document.querySelector(".popup_type_edit-avatar"),N=D.querySelector(".popup__button"),O=document.forms["edit-avatar"],J=O.elements.avatar,M=document.querySelector(".popup_type_confirm-delete"),G=M.querySelector(".popup__button");Promise.all([fetch("".concat(l.baseUrl,"users/me"),{method:"GET",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){return console.log(e)})),fetch("".concat(l.baseUrl,"cards"),{method:"GET",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){return console.log(e)}))]).then((function(a){!function(t){v.textContent=t.name,h.textContent=t.about,y.style="background-image: url(".concat(t.avatar,")"),y.alt=t.name,e=t._id}(a[0]),a[1].forEach((function(a){m.append(t(a,o,n,H,_,e,p,f,d,r,c,M,G))}))}));var H=function(e){T.src=e.target.src,T.alt=e.target.alt,w.textContent=e.target.alt,r(A)};y.addEventListener("click",(function(){r(D),s([J],N)})),E.addEventListener("click",(function(){C.value=v.textContent,x.value=h.textContent,r(k),s([C,x],S)})),g.addEventListener("click",(function(){r(b),s([P,U],q)})),L.addEventListener("submit",(function(e){var t,n;e.preventDefault(),V(!0,S),(t=C.value,n=x.value,fetch("".concat(l.baseUrl,"users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){v.textContent=e.name,h.textContent=e.about})).finally((function(){V(!1,S)})),c(k)})),j.addEventListener("submit",(function(a){var u,i;a.preventDefault(),V(!0,q),(u=P.value,i=U.value,fetch("".concat(l.baseUrl,"cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:u,link:i})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(a){m.prepend(t(a,o,n,H,_,e,p,f,d,r,c,M,G))})).finally((function(){V(!1,q)})),c(b)})),O.addEventListener("submit",(function(e){var t;V(!0,N),e.preventDefault(),(t=J.value,fetch("".concat(l.baseUrl,"users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){y.style="background-image: url(".concat(e.avatar,")")})).finally((function(){V(!1,N)})),c(D)}));var V=function(e,t){t.textContent=e?"Сохранение...":"Сохранить"};document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){c(e.closest(".popup"))}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");s(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_error"),n.classList.remove("popup__text-error_active"),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_error"),o.textContent=n,o.classList.add("popup__text-error_active")}(e,t,t.validationMessage)}(e,o),s(t,n)}))}))}(e)}))})();